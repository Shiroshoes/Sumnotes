MainForm:



<UpperLayout>:
    orientation: "horizontal"
    size_hint_y: None
    height: dp(70)
    padding: (10, 10, 10, 10)
    spacing: dp(10)

    # menu button
    MDIconButton:
        id: menu_button
        icon: "dots-horizontal"
        icon_size: "25sp"
        on_release: root.dispatch("on_menu_press")
        canvas.before:
            Color:
                rgb: 183/255, 183/255, 183/255
            RoundedRectangle:
                size: self.size
                pos: self.pos
                radius: [9, 9, 9, 9]

    # search bar
    MDTextField:
        hint_text: "Search"
        mode: "rectangle"
        fill_color: 183/255, 183/255, 183/255, 1

    # search button
    MDIconButton:
        icon: "magnify"

    # logo
    Image:
        source: "sumnotes.png"
        size_hint: None, None
        size: dp(50), dp(50)



<Settingsform>:
    orientation: "vertical"
    spacing: 0
    padding: 0

    # Top-right cog button
    AnchorLayout:
        anchor_x: "left"
        anchor_y: "top"
        size_hint_y: None
        height: dp(50)

        MDIconButton:
            icon: "cog"
            icon_size: "25sp"
            size_hint: None, None
            size: dp(50), dp(50)
            on_release: app.root.ids.nav_drawer.set_state("close"); app.root.ids.screen_manager.current = "main"


    # Divider line right below the cog
    Widget:
        id: divider_line
        size_hint_y: None
        height: dp(2)
        canvas.before:
            Color:
                rgba: root.line_color
            Line:
                points: self.x, self.center_y, self.right, self.center_y
                width: 2

    # Theme section title
    MDLabel:
        text: "Theme"
        halign: "left"
        bold: True
        padding: dp(10), dp(10)
        size_hint_y: None
        height: dp(40)
            
    BoxLayout:
        orientation: "horizontal"
        padding: dp(20), 0
        spacing: dp(10)
        size_hint_y: None
        height: dp(40)

        Label:
            id: theme_label
            text: app.get_mode_text(theme_switch.active)
            color: app.get_mode_color(theme_switch.active)
            halign: "left"
            valign: "middle"
            text_size: None, None
            size_hint_x: None
            width: self.texture_size[0] + dp(10)
            pos_hint: {"center_y": 0.75} 

        MDSwitch:
            id: theme_switch
            size_hint_x: None
            width: dp(60)
            on_active: app.toggle_theme(self.active)

    BoxLayout:
        orientation: "horizontal"
        padding: dp(20), dp(10)
        spacing: dp(20)
        size_hint_y: None
        height: dp(50)

        MDRaisedButton:
            id: save_button
            text: "Save"
            disabled: True  # start disabled

        MDFlatButton:
            text: "Cancel"

    #Summarizer switch
    BoxLayout:
        orientation: "horizontal"
        padding: dp(20), 0
        spacing: dp(10)
        size_hint_y: None
        height: dp(40)

        Label:
            id: summarizer_label
            text: "Summarizer"
            color: app.get_mode_color(theme_switch.active)
            halign: "left"
            valign: "middle"
            size_hint_x: None
            width: self.texture_size[0] + dp(10)
            pos_hint: {"center_y": 0.75} 

        MDSwitch:
            id: summarizer_switch
            size_hint_x: None
            width: dp(60)
            on_active: app.toggle_summarizer(self.active)

    # Spacer to fill the rest of the phone
    Widget:
        size_hint_y: 1



<MainForm@MDScreen>:
    MDNavigationLayout:
        ScreenManager:
            id: screen_manager
            MDScreen:
                name: "main"
                BoxLayout:
                    orientation: "vertical"

                    AnchorLayout:
                        anchor_x: "center"
                        anchor_y: "top"
                        size_hint_y: None
                        height: dp(70)
                        UpperLayout:
                            on_menu_press: root.ids.nav_drawer.set_state("open")

                    MDBoxLayout:
                        size_hint_y: None
                        height: dp(2)
                        md_bg_color: 0, 0, 0, 1

                    # Scrollable Notes
                    MDScrollView:
                        MDBoxLayout:
                            orientation: "vertical"
                            spacing: dp(10)
                            padding: dp(10)
                            adaptive_height: True

                            # Pinned Notes
                            MDLabel:
                                text: "Pinned"
                                halign: "left"
                                font_style: "H6"
                                size_hint_y: None
                                height: dp(40)

                            MDGridLayout:
                                cols: 2
                                spacing: dp(10)
                                adaptive_height: True

                                MDCard:
                                    orientation: "vertical"
                                    size_hint: None, None
                                    size: dp(170), dp(200)
                                    padding: dp(10)
                                    radius: [15, 15, 15, 15]
                                    md_bg_color: .85, .85, .85, 1
                                    on_release: app.show_note_detail("Pinned Note Example")

                                    MDBoxLayout:
                                        orientation: "horizontal"
                                        size_hint_y: None
                                        height: dp(30)

                                        MDLabel:
                                            text: "Pinned Title"
                                            font_style: "Subtitle1"
                                            halign: "left"

                                        MDIconButton:
                                            icon: "delete"
                                            theme_icon_color: "Custom"
                                            icon_color: 1, 0, 0, 1
                                            size_hint_x: None
                                            width: dp(40)
                                            opacity: 0

                                    MDLabel:
                                        text: "Pinned note content"
                                        halign: "left"
                                        theme_text_color: "Secondary"

                            # Divider
                            MDBoxLayout:
                                size_hint_y: None
                                height: dp(2)
                                md_bg_color: 0, 0, 0, 1

                            #  Normal Notes 
                            MDLabel:
                                text: "Notes"
                                halign: "left"
                                font_style: "H6"
                                size_hint_y: None
                                height: dp(40)

                            MDGridLayout:
                                cols: 2
                                spacing: dp(10)
                                adaptive_height: True

                                MDCard:
                                    orientation: "vertical"
                                    size_hint: None, None
                                    size: dp(170), dp(200)
                                    padding: dp(10)
                                    radius: [15, 15, 15, 15]
                                    md_bg_color: .85, .85, .85, 1
                                    on_release: app.show_note_detail("Normal Note Example")

                                    MDBoxLayout:
                                        orientation: "horizontal"
                                        size_hint_y: None
                                        height: dp(30)

                                        MDLabel:
                                            text: "Normal Title"
                                            font_style: "Subtitle1"
                                            halign: "left"

                                        MDIconButton:
                                            icon: "delete"
                                            theme_icon_color: "Custom"
                                            icon_color: 1, 0, 0, 1
                                            size_hint_x: None
                                            width: dp(40)
                                            opacity: 0

                                    MDLabel:
                                        text: "Normal note content"
                                        halign: "left"
                                        theme_text_color: "Secondary"

                # +
                MDFloatingActionButton:
                    id: plus_button
                    icon: "plus"
                    pos_hint: {"right": 0.95, "y": 0.05}
                    on_release: root.ids.plus_menu.open_menu(self)

            NoteForm:
                name: "notes"

            MDScreen:
                name: "deleted"
                DeleteNoteForm:
                    nav_drawer: nav_drawer

            MDScreen:
                name: "settings"
                Settingsform:
                    nav_drawer: nav_drawer

        MDNavigationDrawer:
            id: nav_drawer
            BoxLayout:
                orientation: "vertical"
                spacing: 0
                padding: 0

                # Top bar with dots
                AnchorLayout:
                    id: top_bar
                    anchor_x: "right"
                    anchor_y: "top"
                    size_hint_y: None
                    height: dp(50)

                    MDIconButton:
                        id: settings_bin
                        icon: "dots-horizontal"
                        icon_size: "25sp"
                        size_hint: None, None
                        size: dp(50), dp(50)
                        on_release:
                            nav_drawer.set_state("close");

                # Divider line right below dots
                Widget:
                    size_hint_y: None
                    height: dp(2)
                    canvas.before:
                        Color:
                            rgb: 0, 0, 0
                        Line:
                            points: self.x, self.center_y, self.right, self.center_y
                            width: 2

                # List locked right below the line
                MDBoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(5)

                    OneLineIconListItem:
                        text: "Notes"
                        on_release: nav_drawer.set_state("close"); app.root.ids.screen_manager.current = "main"
                        IconLeftWidget:
                            icon: "notebook"

                    OneLineIconListItem:
                        text: "Delete"
                        on_release: nav_drawer.set_state("close"); app.root.ids.screen_manager.current = "deleted"
                        IconLeftWidget:
                            icon: "delete"

                    OneLineIconListItem:
                        text: "Settings"
                        on_release: nav_drawer.set_state("close"); app.root.ids.screen_manager.current = "settings"
                        IconLeftWidget:
                            icon: "cog"


                # Spacer to fill the rest of the phone
                Widget:
                    size_hint_y: 1
    PlusMenu:
        id: plus_menu



<NoteForm>:
    BoxLayout:
        orientation: "vertical"
        
        AnchorLayout:
            anchor_x: "center"
            anchor_y: "top"
            size_hint_y: None
            height: dp(70)
            
            UpperLayout:
                on_menu_press: app.root.ids.nav_drawer.set_state("open")

        # Line divider
        Widget:
            size_hint_y: None
            height: dp(2)
            canvas.before:
                Color:
                    rgb: 0, 0, 0
                Line:
                    points: self.x, self.center_y, self.right, self.center_y
                    width: 2

        # Controls row 
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(50)
            padding: dp(10)

            # Back button
            MDIconButton:
                icon: "chevron-left"
                icon_size: "30sp"
                theme_text_color: "Custom"
                pos_hint: {"center_y": 0.5}
                on_release: app.root.ids.screen_manager.current = "main"
                # text_color: app.get_icon_color(theme_switch.active)
                # on_release: app.go_back()

            Widget:  # pushes the right-side buttons

            # Pin button
            MDIconButton:
                icon: "pin"
                icon_size: "24sp"
                pos_hint: {"center_y": 0.5}

            # Summarize button
            MDRaisedButton:
                text: "Summarize"
                size_hint_x: None
                width: dp(120)
                pos_hint: {"center_y": 0.5}
                md_bg_color: 183/255, 183/255, 183/255, 1 
                text_color: 0, 0, 0, 1
                on_release: root.open_summarize_form()
        
        # Input Notes
        BoxLayout:
            orientation: "vertical"
            padding: dp(10)
            spacing: dp(10)

            MDTextField:
                id: title_input
                hint_text: "Notes Title"
                font_style: "H6"  # makes it bold and larger
                size_hint_y: None
                height: dp(48)

            MDTextField:
                id: paragraph_input
                hint_text: "Notes Paragraph"
                mode: "rectangle"
                multiline: True
                size_hint_y: 1
    
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(50)   # adjust according to your LowerLayout height

            # Bottom divider line locked above LowerLayout
            Widget:
                size_hint_y: None
                height: dp(2)
                canvas.before:
                    Color:
                        rgb: 0, 0, 0
                    Line:
                        points: self.x, self.center_y, self.right, self.center_y
                        width: 2

            LowerLayout:
                size_hint_y: None
                height: dp(48)  # or whatever height your LowerLayout needs



<DeleteNoteForm>:
    BoxLayout:
        orientation: "vertical"
        
        AnchorLayout:
            anchor_x: "center"
            anchor_y: "top"
            size_hint_y: None
            height: dp(70)
            
            UpperLayout:
                on_menu_press: app.root.ids.nav_drawer.set_state("open")

        #Line divider
        Widget:
            size_hint_y: None
            height: dp(2)
            canvas.before:
                Color:
                    rgb: 0, 0, 0
                Line:
                    points: self.x, self.center_y, self.right, self.center_y
                    width: 2

        # pinned section
        MDLabel:
            text: "Deleted Notes"
            halign: "left"
            bold: True
            padding: dp(10), dp(10)
            size_hint_y: None
            height: dp(40)

        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: self.minimum_height   # auto-fit all children
            padding: dp(10)
            spacing: dp(5)

            OneLineIconListItem:
                text: "Deleted Notes"
                IconLeftWidget:
                    icon: "notebook"

            OneLineIconListItem:
                text: "Deleted Notes"
                IconLeftWidget:
                    icon: "notebook"

            OneLineIconListItem:
                text: "Deleted Notes"
                IconLeftWidget:
                    icon: "notebook"

        Widget:

        # Bottom divider line (locked above delete button)
        Widget:
            size_hint_y: None
            height: dp(2)
            canvas.before:
                Color:
                    rgb: 0, 0, 0
                Line:
                    points: self.x, self.center_y, self.right, self.center_y
                    width: 2

        # Delete button row
        AnchorLayout:
            anchor_x: "center"
            anchor_y: "center"
            size_hint_y: None
            height: dp(60)

            MDRaisedButton:
                text: "Delete"
                md_bg_color: 183/255, 183/255, 183/255, 1
                text_color: 0, 0, 0, 1
                size_hint_x: None
                width: dp(120)


            
<LowerLayout>:
    BoxLayout:
        orientation: "horizontal"
        size_hint_y: None
        height: dp(50)
        padding: dp(10)
        spacing: dp(10)

        MDRaisedButton:
            id: save_button
            text: "Save"
            size_hint_x: None
            width: dp(100)
            pos_hint: {"center_y": 0.5}
            md_bg_color: 183/255, 183/255, 183/255, 1 
            text_color: 0, 0, 0, 1

        Widget:

        MDIconButton:
            id: dots_button
            icon: "dots-vertical"
            pos_hint: {"center_y": 0.5}
            on_release: root.open_menu(self)



<ConditionalSummarizeAIForm@BoxLayout>:
    orientation: "vertical"
    size_hint_y: None
    height: self.minimum_height
    padding: dp(10)
    spacing: dp(15)

    MDLabel:
        text: "Summarizer AI"
        halign: "center"
        bold: True
        size_hint_y: None
        height: dp(70)

    MDLabel:
        text: "Would you like to summarize the comments?"
        halign: "center"
        size_hint_y: None
        height: dp(80)

    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        size_hint_y: None
        height: dp(60)

        BoxLayout:
            orientation: "horizontal"
            size_hint_x: None
            width: dp(220)
            spacing: dp(20)

            MDFlatButton:
                text: "Yes"
                size_hint_x: None
                width: dp(100)
                md_bg_color: 183/255, 183/255, 183/255, 1
                text_color: 0, 0, 0, 1
                on_release: root.do_summarize()
            
            Widget:

            MDFlatButton:
                text: "Cancel"
                size_hint_x: None
                width: dp(100)
                md_bg_color: 183/255, 183/255, 183/255, 1
                text_color: 0, 0, 0, 1
                on_release: root.close_dialog()



<SummarizerResultsForm>:
    MDCard:
        orientation: "vertical"
        padding: dp(10)
        spacing: dp(10)
        radius: [12, 12, 12, 12]
        elevation: 8
        size_hint: None, None
        size: dp(360), dp(500)
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        # Title (centered at top)
        MDLabel:
            text: "Summarize Result"
            halign: "center"
            bold: True
            theme_text_color: "Primary"
            font_style: "H6"
            size_hint_y: None
            height: dp(40)
            text_size: self.width, None

        # Divider line
        MDSeparator:
            height: dp(1)

        # Scrollable Content Section
        ScrollView:
            size_hint_y: None
            height: dp(250)   # adjust as needed
            do_scroll_x: False
            
            MDBoxLayout:
                id: result_box
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)
                padding: dp(5)
            
                # Result text
                MDLabel:
                    id: result_label
                    text: "Your summarized text will appear here..."
                    halign: "left"
                    theme_text_color: "Secondary"
                    size_hint_y: None
                    height: self.texture_size[1]
                    text_size: self.width - dp(20), None
                    padding: dp(10), dp(10)

        Widget:   # Spacer to push button to bottom

        # Action button (centered at bottom)
        AnchorLayout:
            anchor_x: "center"
            anchor_y: "center"
            size_hint_y: None
            height: dp(50)

            MDRaisedButton:
                text: "Close"
                on_release: app.close_result_card()
                md_bg_color: 183/255, 183/255, 183/255, 1
                text_color: 0, 0, 0, 1

